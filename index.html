<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dblite: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dblite
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">Simple query interface for SQL databases</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">dblite Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Simple query interface to SQL databases.</p>
<p>Supports SQLite and Postgres.</p>
<ul>
<li><a href="#api">API</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#queries">Queries</a><ul>
<li><a href="#name-quoting">Name quoting</a></li>
</ul>
</li>
<li><a href="#adapters-and-converters">Adapters and converters</a></li>
<li><a href="#sqlite">SQLite</a></li>
<li><a href="#postgres">Postgres</a></li>
</ul>
<p><a class="anchor" id="api"></a> </p>
<h1><a class="anchor" id="autotoc_md0"></a>
API</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac52845887038d4719adc68e3e88bef1e" title="Returns a Database object.">dblite.init()</a></code> </td><td class="markdownTableBodyNone">returns a opened <code>dblite.Database</code> object, the first created if no options given  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a1643c7653efcf6100cc672df1bc59234" title="Convenience wrapper for database SELECT and fetch all.">dblite.fetchall()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns all rows  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a9d0403d96b093a60701f765de0f1dc13" title="Convenience wrapper for database SELECT and fetch one.">dblite.fetchone()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns a single row, or <code>None</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac2830d87b7ef903efae946ef44f15fa8" title="Convenience wrapper for database INSERT, returns inserted row ID.">dblite.insert()</a></code> </td><td class="markdownTableBodyNone"><code>INSERT</code> a single row into table, returns inserted ID  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ad5d53b2d8e81a5dfb1c5b750b896c6d9" title="Convenience wrapper for database SELECT, returns database cursor.">dblite.select()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns cursor  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a96bcd45247e5044ca3c4bb0321271368" title="Convenience wrapper for database UPDATE, returns affected row count.">dblite.update()</a></code> </td><td class="markdownTableBodyNone"><code>UPDATE</code> table, returns affected row count  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac138b8780a7056b6690835e45e6f0c7d" title="Convenience wrapper for database DELETE, returns affected row count.">dblite.delete()</a></code> </td><td class="markdownTableBodyNone"><code>DELETE</code> from table, returns affected row count  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a93fa6dc495fe1cef39bb09417ad4afcf" title="Executes the SQL statement and returns database cursor.">dblite.execute()</a></code> </td><td class="markdownTableBodyNone">executes SQL with arguments, returns cursor  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a4a96ce331b02a3cfbebcd94b16508f70" title="Executes the SQL as script of any number of statements.">dblite.executescript()</a></code> </td><td class="markdownTableBodyNone">executes SQL as a script of one or more SQL statements  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a3409a60def4d192a3d1758f337b69489" title="Closes the default database connection, if any.">dblite.close()</a></code> </td><td class="markdownTableBodyNone">closes the database and all pending transactions, if open  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#aa6ca49ff7108d313c2a159bceb4a9824" title="Returns a transaction context manager.">dblite.transaction()</a></code> </td><td class="markdownTableBodyNone">returns <code>dblite.Transaction</code> context manager  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a61b20cce18ca828a3354e6bc5a05ca82" title="Registers function to auto-adapt given Python types to database types in query parameters.">dblite.register_adapter()</a></code> </td><td class="markdownTableBodyNone">registers function to auto-adapt given Python types to database types in query parameters  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a4187d66095bf5c0463aded129c6bc880" title="Registers function to auto-convert given database types to Python in query results.">dblite.register_converter()</a></code> </td><td class="markdownTableBodyNone">registers function to auto-convert given database types to Python in query results  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>dblite.Database</b> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a1643c7653efcf6100cc672df1bc59234" title="Convenience wrapper for database SELECT and fetch all.">Database.fetchall()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns all rows  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a9d0403d96b093a60701f765de0f1dc13" title="Convenience wrapper for database SELECT and fetch one.">Database.fetchone()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns a single row, or <code>None</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac2830d87b7ef903efae946ef44f15fa8" title="Convenience wrapper for database INSERT, returns inserted row ID.">Database.insert()</a></code> </td><td class="markdownTableBodyNone"><code>INSERT</code> a single row into table, returns inserted ID  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ad5d53b2d8e81a5dfb1c5b750b896c6d9" title="Convenience wrapper for database SELECT, returns database cursor.">Database.select()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns cursor  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a96bcd45247e5044ca3c4bb0321271368" title="Convenience wrapper for database UPDATE, returns affected row count.">Database.update()</a></code> </td><td class="markdownTableBodyNone"><code>UPDATE</code> table, returns affected row count  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac138b8780a7056b6690835e45e6f0c7d" title="Convenience wrapper for database DELETE, returns affected row count.">Database.delete()</a></code> </td><td class="markdownTableBodyNone"><code>DELETE</code> from table, returns affected row count  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a93fa6dc495fe1cef39bb09417ad4afcf" title="Executes the SQL statement and returns database cursor.">Database.execute()</a></code> </td><td class="markdownTableBodyNone">executes SQL with arguments, returns cursor  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a4a96ce331b02a3cfbebcd94b16508f70" title="Executes the SQL as script of any number of statements.">Database.executescript()</a></code> </td><td class="markdownTableBodyNone">executes SQL as a script of one or more SQL statements  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#aa6ca49ff7108d313c2a159bceb4a9824" title="Returns a transaction context manager.">Database.transaction()</a></code> </td><td class="markdownTableBodyNone">returns <code>dblite.Transaction</code> context manager  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_database.html#ac68cafe0ed5bd0c45bb5271f4e7deb1d">Database.open()</a></code> </td><td class="markdownTableBodyNone">opens database connection if not already open  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a3409a60def4d192a3d1758f337b69489" title="Closes the default database connection, if any.">Database.close()</a></code> </td><td class="markdownTableBodyNone">closes the database and all pending transactions, if open  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_queryable.html#a57270e6d7b99c314c5f2d516e913052f">Database.closed</a></code> </td><td class="markdownTableBodyNone">whether database is not open  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_queryable.html#afdf844befc3e040137d70e553440b165">Database.cursor</a></code> </td><td class="markdownTableBodyNone">database engine cursor object  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>dblite.Transaction</b> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a1643c7653efcf6100cc672df1bc59234" title="Convenience wrapper for database SELECT and fetch all.">Transaction.fetchall()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns all rows  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a9d0403d96b093a60701f765de0f1dc13" title="Convenience wrapper for database SELECT and fetch one.">Transaction.fetchone()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns a single row, or <code>None</code>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac2830d87b7ef903efae946ef44f15fa8" title="Convenience wrapper for database INSERT, returns inserted row ID.">Transaction.insert()</a></code> </td><td class="markdownTableBodyNone"><code>INSERT</code> a single row into table, returns inserted ID  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ad5d53b2d8e81a5dfb1c5b750b896c6d9" title="Convenience wrapper for database SELECT, returns database cursor.">Transaction.select()</a></code> </td><td class="markdownTableBodyNone">runs <code>SELECT</code>, returns cursor  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a96bcd45247e5044ca3c4bb0321271368" title="Convenience wrapper for database UPDATE, returns affected row count.">Transaction.update()</a></code> </td><td class="markdownTableBodyNone"><code>UPDATE</code> table, returns affected row count  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#ac138b8780a7056b6690835e45e6f0c7d" title="Convenience wrapper for database DELETE, returns affected row count.">Transaction.delete()</a></code> </td><td class="markdownTableBodyNone"><code>DELETE</code> from table, returns affected row count  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a93fa6dc495fe1cef39bb09417ad4afcf" title="Executes the SQL statement and returns database cursor.">Transaction.execute()</a></code> </td><td class="markdownTableBodyNone">executes SQL with arguments, returns cursor  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a4a96ce331b02a3cfbebcd94b16508f70" title="Executes the SQL as script of any number of statements.">Transaction.executescript()</a></code> </td><td class="markdownTableBodyNone">executes SQL as a script of one or more SQL statements  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_transaction.html#a5c6bb98a718b0fe9cdc300fdc109437b">Transaction.commit()</a></code> </td><td class="markdownTableBodyNone">commits pending actions, if any  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_transaction.html#ae67fc3701db8782784515a9478a8778c">Transaction.rollback()</a></code> </td><td class="markdownTableBodyNone">rolls back pending actions, if any  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1api.html#a3409a60def4d192a3d1758f337b69489" title="Closes the default database connection, if any.">Transaction.close()</a></code> </td><td class="markdownTableBodyNone">closes the transaction, performing commit or rollback as specified  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_queryable.html#a57270e6d7b99c314c5f2d516e913052f">Transaction.closed</a></code> </td><td class="markdownTableBodyNone">whether transaction is not open  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_queryable.html#afdf844befc3e040137d70e553440b165">Transaction.cursor</a></code> </td><td class="markdownTableBodyNone">database engine cursor object  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="classdblite_1_1api_1_1_transaction.html#a67d7d150b87b1b595e6306da3ba2817e">Transaction.database</a></code> </td><td class="markdownTableBodyNone">returns transaction <code>Database</code> instance  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Internal modules</b> </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1engines_1_1postgres.html">dblite.engines.postgres</a></code> </td><td class="markdownTableBodyNone">Postgres plugin  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="namespacedblite_1_1engines_1_1sqlite.html">dblite.engines.sqlite</a></code> </td><td class="markdownTableBodyNone">SQLite plugin  </td></tr>
</table>
<p><a class="anchor" id="usage"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Usage</h1>
<div class="fragment"><div class="line">import dblite</div>
<div class="line"> </div>
<div class="line">dblite.init(&quot;:memory:&quot;)  # Open SQLite in-memory database</div>
<div class="line">dblite.executescript(&quot;CREATE TABLE test (id INTEGER PRIMARY KEY, val TEXT)&quot;)</div>
<div class="line">dblite.insert(&quot;test&quot;, val=None)</div>
<div class="line">for i in range(5):</div>
<div class="line">    dblite.insert(&quot;test&quot;, {&quot;val&quot;: i})</div>
<div class="line">dblite.fetchone(&quot;test&quot;, id=1)  # Queries return dictionaries</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=&quot;val&quot;, limit=3)</div>
<div class="line">dblite.update(&quot;test&quot;, {&quot;val&quot;: None}, val=2)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, val=(&quot;IN&quot;, range(3)))</div>
<div class="line">dblite.delete(&quot;test&quot;, id=5)</div>
<div class="line">dblite.executescript(&quot;DROP TABLE test&quot;)</div>
</div><!-- fragment --><p>Provides a simple context manager for transactions:</p>
<div class="fragment"><div class="line"># dblite.init(&quot;sqlite path&quot; or {..postgres opts..})</div>
<div class="line">with dblite.transaction() as tx:</div>
<div class="line">    tx.insert(&quot;test&quot;, val=&quot;will be rolled back&quot;)</div>
<div class="line">    tx.update(&quot;test&quot;, {&quot;val&quot;: &quot;will be rolled back&quot;}, id=0)</div>
<div class="line">    raise dblite.Rollback  # Rolls back uncommitted actions and exits block</div>
<div class="line">    tx.insert(&quot;test&quot;, val=&quot;this will never be reached&quot;)</div>
<div class="line">print(&quot;continuing, Rollback does not propagate out of managed context&quot;)</div>
<div class="line"> </div>
<div class="line">with dblite.transaction(commit=False) as tx:</div>
<div class="line">    tx.insert(&quot;test&quot;, val=&quot;will be committed&quot;)</div>
<div class="line">    tx.commit()  # Commits uncommitted actions</div>
<div class="line">    tx.insert(&quot;test&quot;, val=&quot;will be rolled back&quot;)</div>
<div class="line">    tx.rollback()  # Rolls back uncommitted actions</div>
<div class="line">    tx.insert(&quot;test&quot;, val=&quot;will roll back automatically: no autocommit&quot;)</div>
</div><!-- fragment --><p>Queries directly on the Database object use autocommit mode.</p>
<p>Database instances are usable as context managers:</p>
<div class="fragment"><div class="line">with dblite.init(&quot;my.sqlite&quot;) as db:  # File will be closed on exiting block</div>
<div class="line">    db.executescript(&quot;CREATE TABLE test (id INTEGER PRIMARY KEY, val TEXT)&quot;)</div>
<div class="line">    db.insert(&quot;test&quot;, id=1, val=&quot;value&quot;)</div>
</div><!-- fragment --><p>The first Database instance created for engine is cached per engine, consecutive <code><a class="el" href="namespacedblite_1_1api.html#ac52845887038d4719adc68e3e88bef1e" title="Returns a Database object.">init()</a></code> calls with no connection options yield the cached instance.</p>
<div class="fragment"><div class="line"># Create default database for SQLite</div>
<div class="line">dblite.init(&quot;:memory:&quot;)</div>
<div class="line"># All module-level queries use the very first created</div>
<div class="line">dblite.fetchall(&quot;sqlite_master&quot;)</div>
<div class="line"> </div>
<div class="line"># Create default database for Postgres</div>
<div class="line">dblite.init(&quot;postgresql://user@localhost/mydb&quot;)</div>
<div class="line"># All module-level queries use the very first created: SQLite</div>
<div class="line">dblite.fetchone(&quot;sqlite_master&quot;)</div>
<div class="line"># Access the second default Database</div>
<div class="line">dblite.init(engine=&quot;postgres&quot;).fetchall(&quot;information_schema.columns&quot;)</div>
<div class="line"> </div>
<div class="line"># Grab references to either</div>
<div class="line">db1 = dblite.init(engine=&quot;sqlite&quot;)</div>
<div class="line">db2 = dblite.init(engine=&quot;postgres&quot;)</div>
</div><!-- fragment --><p><a class="anchor" id="queries"></a> </p>
<h1><a class="anchor" id="autotoc_md2"></a>
Queries</h1>
<p>Columns to <code>SELECT</code> can be a string, or a sequence of strings:</p>
<div class="fragment"><div class="line"># Result: SELECT *</div>
<div class="line">dblite.fetchone(&quot;test&quot;)</div>
<div class="line">dblite.fetchone(&quot;test&quot;, &quot;*&quot;)</div>
<div class="line"> </div>
<div class="line"># Result: SELECT id</div>
<div class="line">dblite.fetchone(&quot;test&quot;, &quot;id&quot;)</div>
<div class="line">dblite.fetchone(&quot;test&quot;, [&quot;id&quot;])</div>
<div class="line"> </div>
<div class="line"># Result: SELECT id, val</div>
<div class="line">dblite.fetchone(&quot;test&quot;, &quot;id, val&quot;)</div>
<div class="line">dblite.fetchone(&quot;test&quot;, [&quot;id&quot;, &quot;val&quot;])</div>
<div class="line"> </div>
<div class="line"># Can be arbitrary SQL expressions, invoking functions and assigning aliases</div>
<div class="line">dblite.fetchone(&quot;test&quot;, &quot;COUNT(*) AS total&quot;)</div>
</div><!-- fragment --><p>Keyword arguments are added to <code>WHERE</code> clause, or to <code>VALUES</code> clause for <code>INSERT</code>:</p>
<div class="fragment"><div class="line">myid = dblite.insert(&quot;test&quot;, val=&quot;lorem&quot;)</div>
<div class="line">dblite.update(&quot;test&quot;, {&quot;val&quot;: &quot;lorem ipsum&quot;}, id=myid)</div>
<div class="line">dblite.fetchone(&quot;test&quot;, id=myid)</div>
<div class="line">dblite.delete(&quot;test&quot;, val=&quot;lorem ipsum&quot;)</div>
</div><!-- fragment --><p><code>WHERE</code> clause supports simple equality match, binary operators, collection lookups (<code>"IN"</code>, <code>"NOT IN"</code>), raw SQL strings, or arbitrary SQL expressions. Used SQL needs to be supported by the underlying engine.</p>
<div class="fragment"><div class="line">dblite.fetchall(&quot;test&quot;, val=&quot;ciao&quot;)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, where={&quot;id&quot;: (&quot;&lt;&quot;, 10)})</div>
<div class="line">dblite.fetchall(&quot;test&quot;, id=(&quot;IN&quot;, list(range(5))))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, val=(&quot;!=&quot;, None))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, val=(&quot;IS NOT&quot;, None))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, val=(&quot;LIKE&quot;, &quot;%a%&quot;))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, where=[(&quot;LENGTH(val)&quot;, (&quot;&gt;&quot;, 4))])</div>
<div class="line"> </div>
<div class="line">dblite.fetchall(&quot;test&quot;, where=[(&quot;EXPR&quot;, (&quot;LENGTH(val) &gt; ?&quot;, [4]))])</div>
<div class="line">dblite.fetchall(&quot;test&quot;, where=[(&quot;EXPR&quot;, (&quot;val = ? OR id &gt; ? or id &lt; ?&quot;, [0, 1, 2]))])</div>
</div><!-- fragment --><p><code>WHERE</code> arguments are <code>AND</code>-ed together, <code>OR</code> needs subexpressions:</p>
<div class="fragment"><div class="line"># Result: WHERE (id &lt; 1 OR id &gt; 2) AND val = 3</div>
<div class="line">dblite.fetchall(&quot;test&quot;, where=[(&quot;id &lt; ? OR id &gt; ?&quot;, [1, 2]), (&quot;val&quot;, 3)])</div>
</div><!-- fragment --><p>Argument for key-value parameters, like <code>WHERE</code> or <code>VALUES</code>, can be a dict, or a sequence of key-value pairs:</p>
<div class="fragment"><div class="line"># Result: SET val = &#39;done&#39; WHERE id = 1</div>
<div class="line">dblite.update(&quot;test&quot;, values={&quot;val&quot;: &quot;done&quot;}, where=[(&quot;id&quot;, 1)])</div>
</div><!-- fragment --><p>Argument for sequence parameters, like <code>GROUP BY</code>, <code>ORDER BY</code>, or <code>LIMIT</code>, can be an iterable sequence like list or tuple, or a single value.</p>
<div class="fragment"><div class="line"># Result: SELECT * FROM test GROUP BY val</div>
<div class="line">dblite.fetchall(&quot;test&quot;, group=&quot;val&quot;)</div>
<div class="line"># Result: SELECT * FROM test GROUP BY id, val</div>
<div class="line">dblite.fetchall(&quot;test&quot;, group=&quot;id, val&quot;)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, group=(&quot;id&quot;, &quot;val&quot;))</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Result: SELECT * FROM test ORDER BY id</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=&quot;id&quot;)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=&quot;id ASC&quot;)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=(&quot;id&quot;, False))</div>
<div class="line"># Result: SELECT * FROM test ORDER BY id ASC val DESC</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=&quot;id, val DESC&quot;)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=[&quot;id&quot;, (&quot;val&quot;, True)])</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=[(&quot;id&quot;, False), (&quot;val&quot;, True)])</div>
<div class="line">dblite.fetchall(&quot;test&quot;, order=[(&quot;id&quot;, &quot;ASC&quot;), (&quot;val&quot;, &quot;DESC&quot;)])</div>
</div><!-- fragment --><div class="fragment"><div class="line"># Result: SELECT * FROM test LIMIT 2 OFFSET 0</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=2)</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(2, 0))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(2, -1))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(2, None))</div>
<div class="line"># Result: SELECT * FROM test LIMIT 2 OFFSET 10</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(2, 10))</div>
<div class="line"># Result: SELECT * FROM test OFFSET 10</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(-1, 10))</div>
<div class="line">dblite.fetchall(&quot;test&quot;, limit=(None, 10))</div>
</div><!-- fragment --><p><a class="anchor" id="name-quoting"></a> </p>
<h3><a class="anchor" id="autotoc_md3"></a>
Name quoting</h3>
<p>Table and column names are not quoted automatically. Names with whitespace or non-alphanumeric characters or reserved words can be quoted with <code><a class="el" href="namespacedblite_1_1engines_1_1postgres.html#a88f7951cd0e48638ef8fc026bdac91bb" title="Returns identifier in quotes and proper-escaped for queries, if value needs quoting (has non-alphanum...">Database.quote()</a></code> and <code><a class="el" href="namespacedblite_1_1engines_1_1postgres.html#a88f7951cd0e48638ef8fc026bdac91bb" title="Returns identifier in quotes and proper-escaped for queries, if value needs quoting (has non-alphanum...">Transaction.quote()</a></code>:</p>
<div class="fragment"><div class="line">with dblite.init(&quot;my.sqlite&quot;) as db:</div>
<div class="line">    db.executescript(&quot;CREATE TABLE test (id INTEGER PRIMARY KEY, %s TEXT)&quot; %</div>
<div class="line">                     db.quote(&quot;my column&quot;))</div>
<div class="line">    db.insert(&quot;test&quot;, {&quot;id&quot;: 1, db.quote(&quot;my column&quot;): &quot;value&quot;})</div>
<div class="line">    for row in db.select(&quot;test&quot;):</div>
<div class="line">        print(row[&quot;my column&quot;])</div>
</div><!-- fragment --><p>Note that in Postgres, quoted identifiers are case-sensitive.</p>
<p><a class="anchor" id="adapters-and-converters"></a> </p>
<h1><a class="anchor" id="autotoc_md4"></a>
Adapters and converters</h1>
<p>Provides options to register custom adapters and converters, to auto-adapt Python types to database types in query parameters, and to auto-convert database types to Python types in query results.</p>
<div class="fragment"><div class="line">dblite.init(&quot;:memory:&quot;)</div>
<div class="line">dblite.register_adapter(json.dumps, (dict, list, tuple))</div>
<div class="line">dblite.register_converter(json.loads, &quot;JSON&quot;)</div>
<div class="line"> </div>
<div class="line">dblite.executescript(&quot;CREATE TABLE test (id INTEGER PRIMARY KEY, data JSON)&quot;)</div>
<div class="line">dblite.insert(&quot;test&quot;, id=1, data={&quot;some&quot;: {&quot;nested&quot;: [&quot;data&quot;, 1, 2]}})</div>
<div class="line">dblite.fetchone(&quot;test&quot;)  # `data` is auto-converted to Python dictionary</div>
</div><!-- fragment --><p><a class="anchor" id="sqlite"></a> </p>
<h1><a class="anchor" id="autotoc_md5"></a>
SQLite</h1>
<p>SQLite connection parameter needs to be a valid path or a path-like object, or the special <code>":memory:"</code> for transient in-memory database.</p>
<p>Connections flags default to <code>check_same_thread=False, detect_types=sqlite3.PARSE_DECLTYPES</code>, can be overridden on init:</p>
<div class="fragment"><div class="line">dblite.init(&quot;/path/to/my.db&quot;, detect_types=False)</div>
</div><!-- fragment --><p>Note that SQLite connections do not support multiple concurrent isolated transactions, transaction state is shared per connection. To mitigate this, Transaction contexts in SQLite default to exclusive access:</p>
<div class="fragment"><div class="line">dblite.init(&quot;:memory:&quot;)</div>
<div class="line">with dblite.transaction() as tx:</div>
<div class="line">    print(&quot;Entering another Transaction with-block will block until this exits.&quot;)</div>
</div><!-- fragment --><p>This can be overridden for <code>SELECT</code>-only transactions:</p>
<div class="fragment"><div class="line">dblite.init(&quot;:memory:&quot;)</div>
<div class="line">with dblite.transaction(exclusive=False) as tx:</div>
<div class="line">    print(&quot;Will only be doing SELECT queries, no need for exclusion.&quot;)</div>
<div class="line">    tx.fetchall(&quot;test&quot;)</div>
</div><!-- fragment --><p><a class="anchor" id="postgres"></a> </p>
<h1><a class="anchor" id="autotoc_md6"></a>
Postgres</h1>
<p>Postgres connection parameters can be:</p><ul>
<li>Postgres URI scheme <code>"postgresql://user:pass@hostname:port/dbname?parameter1=val1&amp;.."</code></li>
<li>Postgres keyword-value format <code>"user=myuser password=mypass host=myhost port=myport dbname=myname .."</code></li>
<li>dictionary of connection options <code>{"user": "myuser", "host": "myhost", ..}</code></li>
</ul>
<div class="fragment"><div class="line"># These are all equivalent:</div>
<div class="line">dblite.init(&quot;postgresql://myuser@myhost/mydb&quot;)</div>
<div class="line">dblite.init(&quot;user=myuser host=myhost dbname=mydb&quot;)</div>
<div class="line">dblite.init({&quot;user&quot;: &quot;myuser&quot;, &quot;host&quot;: &quot;myhost&quot;, &quot;dbname&quot;: &quot;mydb&quot;})</div>
</div><!-- fragment --><p>Postgres connection parameters can also be specified in OS environment, via standard Postgres environment variables like <code>PGUSER</code> and <code>PGPASSWORD</code>.</p>
<p>By default uses a pool of 1..4 connections per Database.</p>
<div class="fragment"><div class="line">with dblite.init(&quot;host=localhost user=postgres dbname=mydb&quot;, maxconn=1):</div>
<div class="line">    print(&quot;Use a pool of only 1 connection.&quot;)</div>
<div class="line">with dblite.init(&quot;host=localhost user=postgres dbname=mydb&quot;, minconn=4, maxconn=8):</div>
<div class="line">    print(&quot;Use a pool of 4..8 connections.&quot;)</div>
</div><!-- fragment --><p>Postgres transactions can specify database table schema name up front:</p>
<div class="fragment"><div class="line">dblite.init(&quot;host=localhost user=postgres dbname=mydb&quot;)</div>
<div class="line">with dblite.transaction(schema=&quot;information_schema&quot;) as tx:</div>
<div class="line">    for row in tx.fetchall(&quot;columns&quot;, table_schema=&quot;public&quot;,</div>
<div class="line">                           order=&quot;table_name, dtd_identifier&quot;):</div>
<div class="line">        print(row[&quot;table_name&quot;], row[&quot;column_name&quot;], row[&quot;data_type&quot;])</div>
</div><!-- fragment --><p>Postgres transactions support server-side cursors for iterative data access, fetching and materializing rows in batches:</p>
<div class="fragment"><div class="line">dblite.init(&quot;host=localhost user=postgres dbname=bigdata&quot;)</div>
<div class="line">with Transaction(lazy=True) as tx:  # Can only run a single query</div>
<div class="line">    for i, row in enumerate(tx.select(&quot;some really huge table&quot;)):</div>
<div class="line">        print(&quot;Processing row #%s&quot; % i)</div>
<div class="line"> </div>
<div class="line"># Can also specify size of fetched batches (default is 2000 rows)</div>
<div class="line">with Transaction(lazy=True, itersize=100) as tx:</div>
<div class="line">    for i, row in enumerate(tx.select(&quot;some really huge table&quot;)):</div>
<div class="line">        print(&quot;Processing row #%s&quot; % i)</div>
</div><!-- fragment --><p>Note that <code><a class="el" href="namespacedblite_1_1api.html#a4a96ce331b02a3cfbebcd94b16508f70" title="Executes the SQL as script of any number of statements.">executescript()</a></code> in Postgres forces an internal reload of schema metadata, allowing `insert()Â´ to return inserted primary key value for newly created tables, and query parameters to be auto-cast to expected column types. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Nov 25 2022 21:27:56 for dblite by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
